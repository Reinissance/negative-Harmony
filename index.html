<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>negative Harmony</title>

  <!-- Generated javascript library includes -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  
  <!-- New Modular System -->
  <script type="application/javascript" src="./src/app.js"></script>
  
  <script> 
    // Global app instance for backward compatibility
    let app;

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', async function () {
      try {
        // Initialize the modular app system
        if (typeof NegativeHarmonyApp !== 'undefined') {
          app = new NegativeHarmonyApp();
          await app.init();
          app.moduleLoaded();
        }
      } catch (error) {
        console.error('Failed to initialize app:', error);
      }
    });

    // Global functions for backward compatibility
    function toggleTransport(element) {
      if (app) app.toggleTransport(element);
    }

    function reloadWithUrl() {
      if (app) app.reloadWithUrl();
    }
  </script>
  <link rel="stylesheet" href="style.css">  
</head>
<body class="boxed">
  <div class="sharethis-sticky-share-buttons" style="display: none;"></div>
  <div id="col_transport" class="col transport"
    style="position: sticky; top: 0; left: 0; width: 100%; height: 100vh; background: radial-gradient(circle, rgb(255, 255, 255) 0%, rgba(0, 0, 0, 0.687) 100%); z-index: 9999; display: flex; justify-content: center; align-items: center; overflow: hidden;">
    <div style="text-align: center;">
      <h3 id="start_prompt" style="color: red;">please click start here first:</h3>
      <input type="checkbox" class="btn-check" id="transportButton" autocomplete="off" onchange="toggleTransport();" style="display: none; visibility: hidden;">
      <label class="btn btn-outline-primary" id="transportLabel" for="transportButton">start</label>
    </div>
  </div>
  <div class="title horizontal row">
    <div class="col">
      <h2>negative Harmony</h2>
      <p><em>Playback MIDI-Files possibly in <a href="https://www.opussciencecollective.com/post/the-harmonic-upside-down-negative-harmony" target="_blank">negative harmony</a> mode or backwards.</em></p>
    </div>
  </div>
  <div class="boxed remain widget horizontal" style="padding: 20px; min-height: 120px; -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); background-color: rgba(0, 0, 0, 0.361);">
    <div style="display: flex; width: 100%;">
      <div style="display: flex; width: 100%;">
        <a class="remain" style="display: none; box-shadow: 0 0 10px rgb(215, 118, 21); width: 50px; height: 50px; background-color: rgba(255, 255, 255, 0.359); border-radius: 3px; border: 1px solid white;" href="javascript:void(0);" onclick="app.modules.settingsManager.shareAndCopy();" title="Image from freeiconspng.com: https://www.freeiconspng.com/img/40132" id="hiddenShareButton"><img src="https://www.freeiconspng.com/uploads/share-sharing-icon-29.png" width="50" alt="Share, sharing icon"/></a>
        <button class="btn btn-outline-danger remain" id="playMidi" style="margin-left: 20px; min-height: 50px; color: rgb(255, 119, 0); font-weight: bold; background-color: rgba(156, 0, 0, 0.622); text-shadow: 0 0 15px rgb(63, 18, 18); flex-grow: 1;">Play MIDI</button>
        <button class="btn btn-outline-light" id="showScore" style="display:none; margin-left: 20px; min-height: 50px; display: flex; align-items: center; justify-content: center;" onclick="app.modules.scoreManager.showScore(true);">Score</button>
      </div>
    </div>
    <input type="range" id="progress-input" style="width: 100%; display: none;" min="0" max="100" step="0.01" value="0" class="form-range">
  </div>
  <div style="display: flex; justify-content: center;">
    <div id="scoreContainer" style=" border: 1px solid white; display: none; margin-top: 20px; padding: 20px; background-color: rgba(0, 0, 0, 0.184); border-radius: 5px; max-width: 870px;">
      <div class="score-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; position: relative;">
        <h4 style="margin: 0;">Music Score</h4>
        <button class="btn btn-outline-light btn-sm" onclick="app.modules.scoreManager.hideScore();">Close</button>
      </div>
      <div style="display: flex; justify-content: center;">
        <div id="score" style="overflow-x: auto; max-width: 500px; position: relative; z-index: 1; background-color: rgba(255, 228, 196, 0.766);"></div>
      </div>
    </div>
  </div>
  <div class="widget container accordion" id="accordionsContainer" style="margin-top: 20px;">
    <div class="accordion-item boxed">
      <h2 class="accordion-header" id="headingOne" style="position: sticky; top: 120px;">
        <button style="position: sticky; top: 120px;" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          MIDI
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionsContainer">
        <div class="accordion-body">
          <div class="horizontal" style="text-align: center;">
            <div style="display: flex; flex-direction: column; margin: 10px;">
              <h3>Midi-Player</h3>
              <p><em>Upload a local file:</em></p>
              <input type="file" id="midiUpload" class="form-control" accept=".mid" style="margin-bottom: 10px;" />
              <p><em>...or try to paste an url here:<br>(e.g. from <a data-toggle="tooltip" href="https://bitmidi.com/" target="_blank" title="Thousands of MidiFiles from Classic over Rock/Pop until Jazz">bitmidi</a>, <a data-toggle="tooltip" href="https://www.mfiles.co.uk/midi-files.htm" target="_blank" title="Classical MidiFiles">mfiles</a> or <a data-toggle="tooltip" target="_blank"href="https://midikaos.mnstrl.org/" title="International folk music">Midikaos</a>).</em></p>
              <div style="display: flex; align-items: center; margin-bottom: 10px; top: 172px; position: sticky;"><input type="text" id="midiUrl" style="margin-right: 10px;" class="form-control" placeholder="search or paste url" onkeypress="if(event.key === 'Enter') reloadWithUrl()"/><button class="btn btn-outline-light" onclick="reloadWithUrl()">load</button></button></div>
              <button class="btn btn-outline-warning" id="resetSpeed" style="margin-bottom: 10px; display: none;" onclick="app.modules.transport.setSpeed(1.0)">reset speed to file</button>
              <label for="speedControl">Playback Speed: </label>
              <input type="range" id="speedControl" min="0.5" max="2" value="1" step="0.01" class="form-range"/>
              <input id="reverseMidi" class="btn-check" type="checkbox">
                  <label class="btn btn-outline-light" for="reverseMidi">reverse</label><br>
              <button class="btn btn-outline-success" id="downloadMidi" style="margin-top: 10px; display:none;" onclick="app.modules.transport.downloadCurrentMidi();">Download MIDI</button>
            </div>
            <div>
              <div id="midiIn">
                <div>MIDI input:</div>
                <select class="form-control" id="midiInputs" onchange="console.log(this.value)"></select>
              </div>
              <div id="midiOut" style="margin-top: 20px;">
                <div>MIDI output:</div>
                <select class="form-control" id="midiOutputs" onchange="console.log(this.value)"></select>
              </div>
            </div>
            <div style="text-align: center;">
              <div class="col events">
                MIDI Panic:<br>
                <button type="button" id="trigger_allNotesOff" class="btn btn-outline-warning" onclick="app.modules.midiManager.sendEvent_allNotesOff();">allNotesOff</button><br>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item boxed">
      <h2 class="accordion-header" id="headingTwo" style="position: sticky; top: 120px;">
        <button style="position: sticky; top: 120px;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          MODE
        </button>
      </h2>
      <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionsContainer">
        <div class="accordion-body">
          <div class="horizontal">
            <div>
              <h2>Mode:</h2>
              <div>
                <select class="form-select" id="parameter_mode" onchange="app.setMode(this.value);">
                <option value="0.0">normal</option>
                <option value="1.0" title="Mirrors notes around the axis of the middle D (C Major becomes A minor and vice versa).">lefthand Piano</option>
                <option value="2.0" title="Mirrors notes around an axis between the 3rds of the root note (eg. C Major becomes C minor and vice versa)." selected>negative Harmony</option>
                </select>
              </div>
            </div>
            <div id="negRoots">
              <h3>Root:</h3>
              <select class="form-select" id="parameter_negRoot" onchange="app.setNegRoot(this.value);">
                <option value="57">Gb</option>
                <option value="64">Db</option>
                <option value="59">Ab</option>
                <option value="66">Eb</option>
                <option value="61">Bb</option>
                <option value="56">F</option>
                <option value="63" selected>C</option>
                <option value="58">G</option>
                <option value="65">D</option>
                <option value="60">A</option>
                <option value="67">E</option>
                <option value="62">B(deutsch: H)</option>
              </select>
            </div>
            <div id="perOkt">
              <h3>Inversion:</h3>
              <div>
                <select id="parameter_perOktave" class="form-select" onchange="app.setPerOctave(this.value);">
                  <option value="0">Total</option>
                  <option value="1">per Octave</option>
                  <option value="2" selected>per Voice</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item boxed">
      <h2 class="accordion-header" id="headingThree" style="position: sticky; top: 120px;">
        <button style="position: sticky; top: 120px;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          REVERB
        </button>
      </h2>
      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionsContainer">
        <div class="accordion-body">
          <div class="horizontal" style="margin-top: 20px;">
            <div>
            <label for="reverbSelect">Reverb: </label>
            <select class="form-select" id="reverbSelect" onchange="app.modules.audioEngine.setIR(this.value);">
              <option value="182806__unfa__ir-02-gunshot-in-a-chapel-mixed">Chapel</option>
              <option value="192228__ligidium__shower-clap-open">Shower</option>
              <option value="463610__greybrother01__winter-forest-01">Winterforest</option>
              <option value="479080__allistersandwich__cathedral_saint_pierre">Cathedral</option>
            </select>
            </div>
            <div>
              <label for="reverbVolume">Reverb Volume: </label>
              <input type="range" id="reverbVolume" min="0.0" max="1.5" step="0.01" value="0.5" oninput="app.modules.audioEngine.setReverbGain(this.value);" class="form-range"/>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item boxed">
      <h2 class="accordion-header" id="headingFour" style="position: sticky; top: 120px; z-index: 9999;">
        <button style="position: sticky; top: 120px; z-index: 9999;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
          INSTRUMENTS
        </button>
      </h2>
      <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionsContainer">
        <div class="accordion-body">
          <div>
            <h1 id="midiFileName" class="title" style="width: 100%;"></h1>
            <div id="file_controls" class="horizontal"><p>no MIDI file loaded.</p></div>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item boxed">
      <h2 class="accordion-header" id="headingFive" style="position: sticky; top: 120px; z-index: 9999;">
        <button style="position: sticky; top: 120px; z-index: 9999;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
          EXAMPLES
        </button>
      </h2>
      <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#accordionsContainer">
        <div class="accordion-body">
          <div>
            <div id="examples" class="horizontal"><p>no Examples file loaded.</p></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <div class="row">
    <span class="link"><em>powered by <a href="https://tonejs.github.io/" target="_blank"><strong>Tone.js</strong></a> and <a href="https://github.com/surikov/webaudiofont" target="_blank"><strong>WebAudioFont</strong></a></em></span>
    <span style="font-size: 0.8em;"><em>This project is open source and <a href="https://github.com/Reinissance/negative-Harmony">hosted on github</a>.</em></span>
  </div>
</body>
<footer>
  <div style="font-size: 0.8em; color: #777; margin-top: 20px;">
    <button class="btn btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#disclaimerCollapse" aria-expanded="false" aria-controls="disclaimerCollapse" style="color:orange;">
      <strong>Disclaimer</strong>
    </button>
    <div class="collapse" id="disclaimerCollapse">
      <p style="color: white; margin: 20px;">This site is for educational and personal use only. 
        Users are responsible for ensuring that any MIDI files they upload or share are 
        either original works, in the public domain, or properly licensed. This site does 
        not host or distribute copyrighted material.</p>
    </div>
    <button class="btn btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#privacyCollapse" aria-expanded="false" aria-controls="privacyCollapse" style="color: orange;">
      <strong>Privacy Notice</strong>
    </button>
    <div class="collapse" id="privacyCollapse">
      <p style="color: white; margin: 20px;">This site uses ShareThis to provide social sharing 
        features. ShareThis may collect data about your browsing activity for analytics 
        and advertising purposes. By using this site, you agree to this data collection. 
        For more information, see the <a href="https://www.sharethis.com/privacy/" target="_blank" rel="noopener noreferrer">ShareThis Privacy Policy</a>.</p>
    </div>
  </div>
</footer>

</html>